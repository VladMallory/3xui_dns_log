# X-UI Log Archiver (Go версия)

Единая интерактивная программа для архивирования логов X-UI панели с возможностью управления автозапуском.

## Структура проекта

```
archive_logs/
├── xui_log_archiver.go     # Единая интерактивная программа
├── xui_log_archiver        # Скомпилированный исполняемый файл
├── go.mod                  # Go модуль
├── archive_logs/           # Отдельные скрипты (устарели)
│   ├── archive_logs.go
│   └── go.mod
├── install_archiver/       # Отдельные скрипты (устарели)
│   ├── install_archiver_hourly.go
│   └── go.mod
└── README.md
```

## Функциональность

### xui_log_archiver - Единая интерактивная программа

**Интерактивное меню:**
1. **Сделать архивирование сейчас** - немедленное выполнение архивирования
2. **Добавить в автозапуск** - установка автоматического выполнения каждые 10 минут
3. **Удалить из автозапуска** - отключение автоматического выполнения
4. **Показать статус автозапуска** - проверка текущего состояния
5. **Выход** - завершение работы программы

**Функции архивирования:**
- Читает новые строки из `/usr/local/x-ui/access.log`
- Добавляет их во временный накопитель `/usr/local/x-ui/temp_hourly_archive.log`
- В начале каждого часа (минута 00) архивирует накопитель в сжатый файл
- Очищает архивы старше 30 дней
- Ведет лог работы в `/usr/local/x-ui/archives/archive.log`

**Управление автозапуском:**
- Автоматическое копирование программы в `/usr/local/bin/xui_log_archiver`
- Создание необходимых директорий и файлов
- Добавление/удаление задачи в crontab для выполнения каждые 10 минут
- Проверка статуса автозапуска

## Установка и использование

### 1. Компиляция программы

```bash
# Компиляция единой программы
cd /root/tools/archive_logs
go build -o xui_log_archiver xui_log_archiver.go
```

### 2. Запуск программы

```bash
# Интерактивный режим
cd /root/tools/archive_logs
sudo ./xui_log_archiver

# Автоматический режим (для cron)
sudo ./xui_log_archiver --cron
```

### 3. Использование интерактивного меню

После запуска программы вы увидите меню:
```
=== X-UI Log Archiver ===
1. Сделать архивирование сейчас
2. Добавить в автозапуск (каждые 10 минут, архивирование в 00 минут часа)
3. Удалить из автозапуска
4. Показать статус автозапуска
5. Выход

Выберите действие (1-5):
```

**Рекомендуемая последовательность:**
1. Сначала выберите пункт 2 для установки автозапуска
2. Затем пункт 4 для проверки статуса
3. При необходимости пункт 1 для ручного архивирования

## Конфигурация

Все пути настраиваются через константы в начале каждого файла:

### archive_logs.go
- `LOG_FILE` - путь к основному лог файлу
- `ARCHIVE_DIR` - директория для архивов
- `STATE_FILE` - файл состояния (последняя обработанная строка)
- `TEMP_HOURLY_LOG` - временный накопитель

### install_archiver_hourly.go
- `ARCHIVE_SCRIPT_PATH` - путь, куда копируется скомпилированный скрипт
- Остальные пути аналогичны основному скрипту

## Логирование

Все операции логируются в файл `/usr/local/x-ui/archives/archive.log` с временными метками.

## Автоматизация

После установки скрипт будет автоматически выполняться каждые 10 минут через crontab.

## Требования

- Go 1.21 или выше
- Права root для установки
- Утилита `gzip` для сжатия архивов
- Утилита `find` для очистки старых архивов
